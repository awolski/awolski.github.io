<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://awol.ski/style.css><title>Scratching the surface of GPG | Tony Wolski</title><meta name=description content="This post is just a reference really to document my beginnings with GPG so that I can refer to it in the future. The GNU Privacy Handbook is a great reference. …"><meta name=author content="Tony Wolski"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=referrer content="no-referrer"><link rel=canonical href=https://awol.ski/scratching-the-surface-of-gpg/></head><body><header id=masthead><h1><a href=/ title="Tony Wolski">Tony Wolski</a></h1></header><main><article class=post><header><h1>Scratching the surface of GPG</h1><small>2015-09-11</small></header><p>This post is just a reference really to document my beginnings with GPG so that I can refer to it in the future. The <a href=https://www.gnupg.org/gph/en/manual.html>GNU Privacy Handbook</a> is a great reference.</p><p>On OS X GPG isn&rsquo;t installed by default so install it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>MacOSX&gt; brew install gpg
</code></pre></div><h2 id=generate-a-new-key-pair>Generate a new key pair</h2><p>Generate yourself a new keypair:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>MacOSX&gt; gpg --gen-key
gpg <span style=color:#f92672>(</span>GnuPG<span style=color:#f92672>)</span> 1.4.19; Copyright <span style=color:#f92672>(</span>C<span style=color:#f92672>)</span> <span style=color:#ae81ff>2015</span> Free Software Foundation, Inc.
This is free software: you are free to change and    redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Please <span style=color:#66d9ef>select</span> what kind of key you want:
   <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> RSA and RSA <span style=color:#f92672>(</span>default<span style=color:#f92672>)</span>
   <span style=color:#f92672>(</span>2<span style=color:#f92672>)</span> DSA and Elgamal
   <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> DSA <span style=color:#f92672>(</span>sign only<span style=color:#f92672>)</span>
   <span style=color:#f92672>(</span>4<span style=color:#f92672>)</span> RSA <span style=color:#f92672>(</span>sign only<span style=color:#f92672>)</span>
Your selection?
</code></pre></div><p>Accept all the defaults for now and enter your personal information when prompted:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>You need a user ID to identify your key; the software constructs the user ID from the Real Name, Comment and Email Address in this form:
<span style=color:#e6db74>&#34;Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;&#34;</span>

Real name: Anthony Wolski
Email address: anthony.wolski@email.com
Comment: No comment
You selected this USER-ID:
    <span style=color:#e6db74>&#34;Anthony Wolski (No comment) &lt;anthony.wolski@bogusemail.com&gt;&#34;</span>

Change <span style=color:#f92672>(</span>N<span style=color:#f92672>)</span>ame, <span style=color:#f92672>(</span>C<span style=color:#f92672>)</span>omment, <span style=color:#f92672>(</span>E<span style=color:#f92672>)</span>mail or <span style=color:#f92672>(</span>O<span style=color:#f92672>)</span>kay/<span style=color:#f92672>(</span>Q<span style=color:#f92672>)</span>uit? O
You need a Passphrase to protect your secret key.

Enter passphrase:
</code></pre></div><p>You can verify that the key was generated by using the <code>--list-keys</code> argument:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>MacOSX&gt; gpg --list-keys
pub   2048R/C2B16D05 2015-09-11
uid                  Anthony Wolski <span style=color:#f92672>(</span>No comment<span style=color:#f92672>)</span> &lt;anthony.wolski@email.com&gt;
sub   2048R/90BF6AD2 2015-09-11
</code></pre></div><p>Now you should follow the instructions at the <a href=https://www.gnupg.org/gph/en/manual.html>GPG manual</a> to generate a revocation certificate. I&rsquo;ll leave that as a task for you.</p><h2 id=export-a-public-key>Export a public key</h2><p>In order to communicate with others you need to generate a public key. The way GPG works is that when somebody wants to send you an encrypted message, they encrypt the document or message using your public key. Only the holder of the private key can decrypt that document or message. So first, you must export a public key.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>MacOSX&gt; gpg --armor --output awolski.gpg --export anthony.wolski@email.com 
MacOSX&gt; cat awolski.gpg
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1
mQENBFXymgEBCACkmLhIHh6QnC7fzql4EttTcopIeejyfHFwzLYFtBd0fsywOQOA
RhUI4B/+8QQkgJ3H0OvcITr0i/kgqZu7+9NsJL7YNDWzE4xKIj6MO+h+GdUhTq4E
ZtHgfE5vy8vGREfup0YIYAdjJjVp/LZv4mmbpCTXT/mUbcywhQ8wqs5r2xtxJZ7t
9pXmP+TlDPursQZt/MkCGxl4XSPQbrrBe9FDa8/R1YVc7SaD8R7p/EeyS2v0a/oM
DWKU4eAETsqi/GKx1B38ObKZuoRe45qQ9Zd/n4KV+++uj5yy+IvWmxDU6vQ8UQVH
3yiPC68wTsPmwvyyZw/ViN2XmaCO/5N5gKD7ABEBAAG0O0FudGhvbnkgV29sc2tp
IChObyBjb21tZW50KSA8YW50aG9ueS53b2xza2lAYm9ndXNlbWFpbC5jb20+iQE4
BBMBAgAiBQJV8poBAhsDBgsJCAcDAgYVCAIJCgsEFgIDAQIeAQIXgAAKCRAzU1dV
wrFtBa2bCACGII7PqA3tLejRDlH9r7arza3HZK/7N3MWZpErtizwT3RxgLJeZ6eg
EmT/q8k5FMtEei56pS2gpvorHc4HXoPRPJxg7ox5LUQzj8wmNQEbKnVfmzo01Bnf
wWbLV4CY469re3haZ+/ylRNLYgYJD7uYu+twGuaGYBAQX1IlZ+3z9l0BFDibjI3U
Hl/RVMNMpZjYX8rf94qBkKjfplCpUsI90M5TtrQYvWLtMEb06L1aA5IKDNY+baBn
nN5XtVyAEvrHtFmATmAA8CrbrmZiMJNkF4j+aJaUO2kKANNXlsY8DzIfKhPNl22F
IfT+jfmeiHauleVgNtO/Ssl1Oja0T9ufuQENBFXymgEBCAC04NV1B2BRBaqOLVbt
mBMzj5XH9nu6XX+m7zXhX1wzi3+Y4cM6O1Ec32T+VCQcsqyoo4I2w/nn60WvTQUV
0LTaAHhRZiycnRCD0dpRAcZyNRKF+4yinsu5ZmWBsXExU/OPt0sL07vDLWat9UZV
O2WXQko5kZmAbjMVoARvP+KDkgYRzDUkBaN2gBcPNEv/gqlQlvIsw4QYvg0PD+HQ
C+Sp/+iwOV92Mcn1ZQmGK+yWUrGtF9JMZxAr52vql9NPsTjYQtOjgpQuGfaCYiWA
pfcWNFgmBn8B6JQ1rYC1UDuEU1CKdM4UC0XszfDH1Z77YZgSM82QiODcKU8ZmMTk
2wHxABEBAAGJAR8EGAECAAkFAlXymgECGwwACgkQM1NXVcKxbQWPLQf/VbSwXCgx
fXAv6hTm3dL+oEmzHgdg+4x+pPctWGXcbf9EXmK5RXlFjvtPbSdxtR4rCbGDTBvs
jcQKh2Hmsqj4M4IBOS/O3oK0A5o+JTpWcjFE7XOAHi+gFESilESKGzg8Sc3BZJ3W
9ZuBFWMhrK5yDYVmP26RBTjlJUDwi6HalNBMbKidjia9M1JGsyLYvewoOoqIBA/g
5ueoscr8mDY8GDpmIvnVxcL06rLwS5sAUOqs6XjUjc1t75O7efjoIvhZcsCAIgRn
2OiI+jIJUkw3iZfAiLc8gSUqkV8hf59ovoYemDoPI9T1XNwwDmedtmFVw9uN61Mc
jtxD8Y9FdYeFvA<span style=color:#f92672>==</span>
<span style=color:#f92672>=</span>7i5A
-----END PGP PUBLIC KEY BLOCK-----
</code></pre></div><p>Now send that key to someone you want to be able to communicate with securely. With your public key, they&rsquo;ll be able to encrypt messages or documents, send them to you in encrypted form, and you, and only you, will be able to decrypt them using your private key.</p><h2 id=import-a-public-key>Import a public key</h2><p>You&rsquo;ll need to import the public key of anyone you want to send encrypted messages to. To demonstrate the process, I booted up a Vagrant machine and created a private keypair on the VM. Then I imported the public key I created previously.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>VagrantVM&gt; gpg --import /vagrant/awolski.gpg
gpg: /home/vagrant/.gnupg/trustdb.gpg: trustdb created
gpg: key C2B16D05: public key <span style=color:#e6db74>&#34;Anthony Wolski (No comment) &lt;anthony.wolski@email.com&gt;&#34;</span> imported
gpg: Total number processed: <span style=color:#ae81ff>1</span>
gpg:               imported: <span style=color:#ae81ff>1</span>  <span style=color:#f92672>(</span>RSA: 1<span style=color:#f92672>)</span>
</code></pre></div><p>Note that /vagrant on the VM is a default synced folder from my OS X host to the VM, and I&rsquo;d copied the exported public key to the root of where my Vagrant file resides. And I&rsquo;d also run <code>vagrant ssh</code> to get into the machine.</p><p>The documentation states that once the key is imported it should be validated. See the documentation above on how to do that, but effectively run gpg with <code>--edit-key</code> and then <code>sign</code> it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>VagrantVM&gt; gpg --edit-key anthony.wolski@email.com
gpg <span style=color:#f92672>(</span>GnuPG<span style=color:#f92672>)</span> 1.4.11; Copyright <span style=color:#f92672>(</span>C<span style=color:#f92672>)</span> <span style=color:#ae81ff>2010</span> Free Software Foundation, Inc.
...
pub  2048R/C2B16D05  created: 2015-09-11  expires: never       usage: SC
                 trust: unknown       validity: unknown
sub  2048R/90BF6AD2  created: 2015-09-11  expires: never       usage: E
<span style=color:#f92672>[</span> unknown<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>. Anthony Wolski <span style=color:#f92672>(</span>No comment<span style=color:#f92672>)</span> &lt;anthony.wolski@bogusemail.com&gt;
gpg&gt; sign
pub   2048R/C2B16D05 2015-09-11 Anthony Wolski <span style=color:#f92672>(</span>No comment<span style=color:#f92672>)</span> &lt;anthony.wolski@bogusemail.com&gt;
 Primary key fingerprint: A510 7F0A 02A9 15DC 03FE  E187 <span style=color:#ae81ff>3353</span> <span style=color:#ae81ff>5755</span> C2B1 6D05
...
Are you really sure that you want to sign this key with your key: <span style=color:#e6db74>&#34;Anthony Wolski (No comment) &lt;anthony.wolski@email.com&gt;&#34;</span>

Really sign?
</code></pre></div><p>Now it&rsquo;s time to encrypt something to send (to yourself!).</p><h2 id=encrypting-a-document>Encrypting a document</h2><p>Now I&rsquo;m going to create a document that I need to send securely:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>VagrantVM&gt; echo <span style=color:#e6db74>&#34;Really secret info&#34;</span> &gt; secret.txt
VagrantVM&gt; cat secret.txt
Really secret info
</code></pre></div><p>And then encrypt it</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>VagrantVM&gt; gpg --output secret.txt.gpg --encrypt --recipient anthony.wolski@email.com secret.txt
</code></pre></div><p>We can verify the contents of the output file have indeed been encrypted:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>VagrantVM&gt; cat secret.txt.gpg
�Emd<span style=color:#f92672>=</span>+��zKy��*�VՏɮ
</code></pre></div><h2 id=decrypting-a-document>Decrypting a document</h2><p>I copied the encrypted file back to my host machine where I originally created my keypair. I can decrypt the file like so:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>MacOSX&gt; gpg --output secret.txt --decrypt secret.txt.gpg
MacOSX&gt; cat secret.txt
Really secret info
</code></pre></div><p>And there you have it, there is the original contents of the secret file unencrypted.</p><footer>&#171; <a href=https://awol.ski/signing-in-to-ec2-instance-with-an-aws-generated-key-pair/>Previous</a>
||
<a href=https://awol.ski/refactoring-with-groovy-and-runtime-method-invocation/>Next</a> &#187;</footer><br><p><strong>Your thoughts?</strong> I'd love to hear them. Please get in <a href=/contact>contact</a>.</p></article></main><footer id=mastfoot><nav><a href=/contact title=Contact>Contact</a></nav></footer></body></html>