<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://awolski.com/style.css><title>Fixing node-gyp make failed on centos in Docker | Tony Wolski</title><meta name=description content="Tony Wolski: I&rsquo;ve had this issue pop up time and time again, so I wanted to document it so that I won&rsquo;t forget in the future. The error below occurs when â€¦"><meta name=author content="Tony Wolski"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=referrer content="no-referrer"><meta name=generator content="Hugo 0.69.0"><link rel=canonical href=https://awolski.com/fixing-node-gyp-make-failed-on-centos-in-docker/></head><body><section id=masthead><h1><a href=/ title="Tony Wolski">Tony Wolski</a></h1><nav><ul><li><a href=/contact title=Contact>Contact</a></li></ul></nav></section><div id=content><article class=post><header><h1>Fixing node-gyp make failed on centos in Docker</h1><small>2015-11-24</small></header><p>I&rsquo;ve had this issue pop up time and time again, so I wanted to document it so that I won&rsquo;t forget in the future. The error below occurs when executing <code>RUN npm install sinopia</code> in a Dockerfile FROM centos:6.6 (no doubt this isn&rsquo;t specific to Docker).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>node-gyp configure build
&lt;span style<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;color:red;&#39;</span>&gt;gyp WARN EACCES user <span style=color:#e6db74>&#34;undefined&#34;</span> does not have permission to access the dev dir <span style=color:#e6db74>&#34;/root/.node-gyp/0.12.7&#34;</span>
gyp WARN EACCES attempting to reinstall using temporary dev dir <span style=color:#e6db74>&#34;/usr/local/node/lib/node_modules/sinopia/node_modules/fs-ext/.node-gyp&#34;</span>&lt;/span&gt;
make: Entering directory <span style=color:#e6db74>`</span>/usr/local/node/lib/node_modules/sinopia/node_modules/fs-ext/build<span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>  CXX(target) Release/obj.target/fs-ext/fs-ext.o
</span><span style=color:#e6db74>&lt;span style=&#39;</span>color:red;<span style=color:#e6db74>&#39;&gt;make: g++: Command not found
</span><span style=color:#e6db74>make: *** [Release/obj.target/fs-ext/fs-ext.o] Error 127&lt;/span&gt;
</span><span style=color:#e6db74>make: Leaving directory `/usr/local/node/lib/node_modules/sinopia/node_modules/fs-ext/build&#39;</span>
&lt;span style<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;color:red;&#39;</span>&gt;gyp ERR! build error
gyp ERR! stack Error: <span style=color:#e6db74>`</span>make<span style=color:#e6db74>`</span> failed with exit code: <span style=color:#ae81ff>2</span>
gyp ERR! stack     at ChildProcess.onExit <span style=color:#f92672>(</span>/usr/local/node/lib/node_modules/npm/node_modules/node-gyp/lib/build.js:269:23<span style=color:#f92672>)</span>
gyp ERR! stack     at ChildProcess.emit <span style=color:#f92672>(</span>events.js:110:17<span style=color:#f92672>)</span>
gyp ERR! stack     at Process.ChildProcess._handle.onexit <span style=color:#f92672>(</span>child_process.js:1074:12<span style=color:#f92672>)</span>
gyp ERR! System Linux 4.1.12-boot2docker
gyp ERR! command <span style=color:#e6db74>&#34;node&#34;</span> <span style=color:#e6db74>&#34;/usr/local/node/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js&#34;</span> <span style=color:#e6db74>&#34;configure&#34;</span> <span style=color:#e6db74>&#34;build&#34;</span>
gyp ERR! cwd /usr/local/node/lib/node_modules/sinopia/node_modules/fs-ext
gyp ERR! node -v v0.12.7
gyp ERR! node-gyp -v v2.0.1
gyp ERR! not ok
npm WARN optional dep failed, continuing crypt3@0.1.8&lt;/span&gt;
</code></pre></div><p>The error seems obvious at first glance; g++ is not installed. But adding that as one of the packages I install at the top of the Dockerfile had no effect whatsoever.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#66d9ef>RUN</span> yum upgrade -y <span style=color:#f92672>&amp;&amp;</span> yum install -y &lt;strong&gt;g++&lt;/strong&gt; tar<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>I trawled loads of GitHub issues and StackOverflow pages with similar problems. Some indicated it was a Node 0.12 issue, so I tried 4.2.1, but the error persisted. Because the sinopia seems to install and run correctly despite the error I almost gave up on trying to fix it. But I just hate seeing those errors in my build&mldr; I had to crack it.</p><p>Then I stumbled <a href=https://github.com/Automattic/node-canvas/issues/625>this GitHub issue</a> that gave me hope:</p><blockquote><p>No, on Centos 7, there is no g++ package in repos. However, I&rsquo;ve installed gcc-c++ and the problem is solved</p></blockquote><pre>
RUN yum upgrade -y && yum install -y <strong>gcc-c++</strong> tar
</pre><p>Problem solved.</p><footer>&#171; <a href=https://awolski.com/starting-services-during-docker-build/>Previous</a>
||
<a href=https://awolski.com/upgrade-docker-on-travis-ci/>Next</a> &#187;</footer></article><div id=comments><strong>Your thoughts?</strong> I'd love to hear them. Please get in <a href=/contact>contact</a>.</div></div></body></html>