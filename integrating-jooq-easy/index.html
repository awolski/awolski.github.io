<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Integrating JOOQ... easy | Tony Wolski</title><meta name=description content="Tony Wolski: Integrating JOOQ into your application is a piece of piss, as I discovered recently when I needed to build some non-ORM/Hibernate database access into some â€¦"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=referrer content="no-referrer"><meta name=generator content="Hugo 0.64.0"><link rel=stylesheet href=https://awolski.com/style.css><link rel=canonical href=https://awolski.com/integrating-jooq-easy/></head><body><section id=masthead><h1><a href=/ title="Tony Wolski">Tony Wolski</a></h1><nav><ul><li><a href=/contact title=Contact>Contact</a></li></ul></nav></section><div id=content><article class=post><header><h1>Integrating JOOQ... easy</h1><small>2014-11-06</small></header><p>Integrating <a href=http://www.jooq.org/>JOOQ</a> into your application is a <a href="http://www.urbandictionary.com/define.php?term=piece%20of%20piss">piece of piss</a>, as I discovered recently when I needed to build some non-ORM/Hibernate database access into some reports. I&rsquo;m upgrading the reports component of an application I develop and needed to add some <em>performant</em> metrics. I didn&rsquo;t want to use direct SQL or JDBC, so I decided to see how JOOQ performed&mldr; and I was pleasantly surprised at how simple it was to set up and use.</p><p>First, add the dependency. I&rsquo;m not using code generation so I only needed the core library.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependency</span><span style=color:#f92672>&gt;</span>
  <span style=color:#f92672>&lt;groupId</span><span style=color:#f92672>&gt;</span>org.jooq<span style=color:#f92672>&lt;/groupId&gt;</span>
  <span style=color:#f92672>&lt;artifactId</span><span style=color:#f92672>&gt;</span>jooq<span style=color:#f92672>&lt;/artifactId&gt;</span>
  <span style=color:#f92672>&lt;version</span><span style=color:#f92672>&gt;</span>3.4.4<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
</code></pre></div><p>This particular application uses <a href=http://weld.cdi-spec.org/>CDI/Weld</a> as its dependency injection framework, so I created a <a href=https://docs.jboss.org/weld/reference/1.0.0/en-US/html/producermethods.html>Producer method</a> which produces a JOOQ DSLContext using the DataSource injected via JNDI using the @Resource annotation:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>  <span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span>
  <span style=color:#f92672>import</span> org.jooq.DSLContext<span style=color:#f92672>;</span>
  <span style=color:#f92672>import</span> org.jooq.SQLDialect<span style=color:#f92672>;</span>
  <span style=color:#f92672>import</span> org.jooq.impl.DSL<span style=color:#f92672>;</span>

  <span style=color:#a6e22e>@SuppressWarnings</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;serial&#34;</span><span style=color:#f92672>)</span>
  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DSLContextProducer</span> <span style=color:#66d9ef>implements</span> Serializable <span style=color:#f92672>{</span>

  <span style=color:#a6e22e>@Resource</span><span style=color:#f92672>(</span>mappedName<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;java:comp/env/jdbc/dataSourceName&#34;</span><span style=color:#f92672>)</span>
  <span style=color:#66d9ef>private</span> DataSource ds<span style=color:#f92672>;</span>

  <span style=color:#a6e22e>@Produces</span>
  <span style=color:#66d9ef>public</span> DSLContext <span style=color:#a6e22e>getDSLContext</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
  	<span style=color:#66d9ef>return</span> DSL<span style=color:#f92672>.</span><span style=color:#a6e22e>using</span><span style=color:#f92672>(</span>ds<span style=color:#f92672>.</span><span style=color:#a6e22e>getConnection</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>,</span> SQLDialect<span style=color:#f92672>.</span><span style=color:#a6e22e>MYSQL</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>This makes the JOOQ DSLContext easy to access throughout the application by simply injecting it wherever it is needed:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Inject</span> DSLContext jooq<span style=color:#f92672>;</span>
</code></pre></div><p>And get busy using:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span>
Field<span style=color:#f92672>&lt;</span><span style=color:#f92672>?</span><span style=color:#f92672>&gt;</span> AVG <span style=color:#f92672>=</span> DSL<span style=color:#f92672>.</span><span style=color:#a6e22e>field</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;avg(metric)&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>as</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Average Some Metric&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
Field<span style=color:#f92672>&lt;</span><span style=color:#f92672>?</span><span style=color:#f92672>&gt;</span> YEAR <span style=color:#f92672>=</span> DSL<span style=color:#f92672>.</span><span style=color:#a6e22e>field</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;EXTRACT(YEAR FROM createdDateTime)&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>as</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Year&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
Field<span style=color:#f92672>&lt;</span><span style=color:#f92672>?</span><span style=color:#f92672>&gt;</span> MONTH <span style=color:#f92672>=</span> DSL<span style=color:#f92672>.</span><span style=color:#a6e22e>field</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;EXTRACT(MONTH FROM createdDateTime)&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>as</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Month&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
<span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span>
jooq<span style=color:#f92672>.</span><span style=color:#a6e22e>select</span><span style=color:#f92672>(</span>AVG<span style=color:#f92672>,</span> YEAR<span style=color:#f92672>,</span> MONTH<span style=color:#f92672>)</span>
  <span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TABLE&#34;</span><span style=color:#f92672>)</span>
  <span style=color:#f92672>.</span><span style=color:#a6e22e>groupBy</span><span style=color:#f92672>(</span>MONTH<span style=color:#f92672>,</span> YEAR<span style=color:#f92672>)</span>
  <span style=color:#f92672>.</span><span style=color:#a6e22e>orderBy</span><span style=color:#f92672>(</span>YEAR<span style=color:#f92672>.</span><span style=color:#a6e22e>desc</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>,</span> MONTH<span style=color:#f92672>.</span><span style=color:#a6e22e>desc</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>
  <span style=color:#f92672>.</span><span style=color:#a6e22e>fetch</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
</code></pre></div><p>There&rsquo;s a lot more to learn, but with <a href=http://www.jooq.org/learn/>fantastic documentation</a>, I have no doubt JOOQ will become one of my go to Java database tools.</p><footer>&#171; <a href=https://awolski.com/mini-journal-with-twitter-ifttt-and-evernote/>Previous</a>
||
<a href=https://awolski.com/enable-hot-deployment-with-tomcat-eclipse-ivy/>Next</a> &#187;</footer></article><div id=comments><strong>Your thoughts?</strong> I'd love to hear them. Please get in <a href=/contact>contact</a>.</div></div></body></html>