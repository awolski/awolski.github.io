<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://awolski.com/style.css><title>Monzo webhooks to Google spreadsheets | Tony Wolski</title><meta name=description content="Tony Wolski: For years I&rsquo;ve used Google spreadsheets to track my finances. I&rsquo;ve tried using services like Money Dashboard in the past, but although they are â€¦"><meta name=author content="Tony Wolski"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=referrer content="no-referrer"><meta name=generator content="Hugo 0.80.0"><link rel=canonical href=https://awolski.com/monzo-to-gsheets/></head><body><section id=masthead><h1><a href=/ title="Tony Wolski">Tony Wolski</a></h1><nav><ul><li><a href=/contact title=Contact>Contact</a></li></ul></nav></section><div id=content><article class=post><header><h1>Monzo webhooks to Google spreadsheets</h1><small>2020-02-07</small></header><p>For years I&rsquo;ve used Google spreadsheets to track my finances. I&rsquo;ve tried using services like <a href=https://www.moneydashboard.com/>Money Dashboard</a> in the past, but although they are simple to use, there is always a feature I want that is missing. I prefer to have control of my data so I can add functionality as and when I need it. So despite the setup and maintenance overhead, a spreadsheet is still the way to go in my opinion.</p><p>I used to export bank and credit card transactions in csv format and import them manually. Doing so was a laborious and time consuming task which I hated, but writing scripts to automate it seemed like overkill, especially when authentication to Google and numerous banks was involved. Not to mention differences in export format between banks.</p><p>Soon after I consolidated my accounts to <a href=https://monzo.com/>Monzo</a> I realised they had an API, including webhooks. <em>Transaction webhooks!</em> I pondered how easy it would be to push my transaction data to Google spreadsheets in <em>real time</em>, eliminating the manual and time consuming process of exporting/importing them myself. I thought if transactions fed directly into my sheet automatically, all I would need to do is categorise them. Simple. I knew it was possible to create web applications GSheets with <a href>Apps Script</a>, so all the ingredients were there.</p><p>After reading some documentation and hacking about for an hour or so I&rsquo;d proven it was entirely possible. Now, when a transaction occurs in my Monzo account it appears in the finance spreadsheet within milliseconds. This post explains how I got it working.</p><p>In my Google spreadsheet I have a Transactions sheet with the following columns: Date, Description, Credit, Debit, Split, Balance, Account, Category, and Comments.</p><p><img src=/assets/img/transaction-sheet.png alt="Transaction sheet"></p><p>I created an Apps Script project (<strong>Tools > Script editor</strong>) and the following function (replacing placeholders with appropriate values).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>doPost</span>(<span style=color:#a6e22e>e</span>) {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;*** doPost(e) ***&#39;</span>);
  <span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>e</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;undefined&#39;</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>contents</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>postData</span>.<span style=color:#a6e22e>contents</span>);
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>contents</span>);
    <span style=color:#66d9ef>try</span> { 
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>transaction</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>contents</span>.<span style=color:#a6e22e>data</span>;
      
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>created</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;T&#39;</span>)[<span style=color:#ae81ff>0</span>];
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>description</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>counterparty</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>description</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>counterparty</span>.<span style=color:#a6e22e>name</span>.<span style=color:#a6e22e>toUpperCase</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; REF &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>notes</span>.<span style=color:#a6e22e>toUpperCase</span>();
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>transaction</span>.<span style=color:#a6e22e>amount</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>100</span>;
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>credit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>;
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>debit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>credit</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#f92672>:</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>amount</span>);
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>account</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Monzo&#39;</span>;
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>comments</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
      
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sheet</span><span style=color:#f92672>=</span> <span style=color:#a6e22e>SpreadsheetApp</span>.<span style=color:#a6e22e>openById</span>(<span style=color:#e6db74>&#39;spreadsheet_id&#39;</span>).<span style=color:#a6e22e>getSheetByName</span>(<span style=color:#e6db74>&#39;Transactions&#39;</span>);
      <span style=color:#a6e22e>sheet</span>.<span style=color:#a6e22e>insertRows</span>(<span style=color:#ae81ff>2</span>);
      <span style=color:#a6e22e>sheet</span>.<span style=color:#a6e22e>getRange</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>10</span>).<span style=color:#a6e22e>setValues</span>([[ <span style=color:#a6e22e>date</span>, <span style=color:#a6e22e>description</span>, <span style=color:#a6e22e>credit</span>, <span style=color:#a6e22e>debit</span>, <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#a6e22e>account</span>, <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#a6e22e>comments</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>postData</span>.<span style=color:#a6e22e>contents</span> ]]);
    }
    <span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span>) {
      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>);
      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span>);
      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>contents</span>);
    }
    <span style=color:#66d9ef>finally</span> {
      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ContentService</span>.<span style=color:#a6e22e>createTextOutput</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({}));
    }
  }
}
</code></pre></div><p>To publish the script as a Web App, click <strong>Publish > Deploy as a web app&mldr;</strong>. In <strong>Execute the app as</strong> I selected myself (my email address), and for <strong>Who has access to the app</strong> I set <em>Anonymous, even anonymous</em>.</p><p><img src=/assets/img/apps-script-deploy.png alt="Apps script deploy webapp"></p><p>After clicking publish, the resultant URL is the endpoint needed to create the Monzo webhook.</p><p><img src=/assets/img/apps-script-deployed.png alt="Apps script webapp deployed"></p><p>I then logged into the <a href=https://developers.monzo.com/api/playground>Monzo Developer Playground</a>. To login you enter your email address and you are sent a login link via email. When you visit the link you are required to authorise access from the Monzo app (nice security).</p><p>Once logged in, I got a list of my accounts by executing the <strong>List accounts</strong> endpoint. This response is a JSON document with a list of accounts details, from which I copied the account id was interested in.</p><p><img src=/assets/img/monzo-list-accounts.png alt="Apps script webapp deployed"></p><p>Finally, in the Register a webhook endpoint, in the sample JSON post data I replaced <code>$account_id</code> and entered the Google Apps Script web app url in the <code>url</code> field.</p><p><img src=/assets/img/monzo-register-webhook.png alt="Apps script webapp deployed"></p><p>And that&rsquo;s it. As soon as the webhook is registered you should start receiving data into your spreadsheet. You can debug what&rsquo;s coming in by using Apps Script Stackdriver Logging (<strong>View > Stackdriver Logging</strong>). I found this really useful to iron out a few issues early on. But my transactions have been coming in automatically now for over six months, saving me a tonne of time and frustration.</p><footer>&#171; <a href=https://awolski.com/devops/>Previous</a>
||
<a href=https://awolski.com/fs/>Next</a> &#187;</footer></article><div id=comments><strong>Your thoughts?</strong> I'd love to hear them. Please get in <a href=/contact>contact</a>.</div></div></body></html>