<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=stylesheet type=text/css href=/style.css><title>Template SoapUI tests with XmlSlurper | Tony Wolski</title><link rel=canonical href=https://awolski.com/template-soapui-tests-with-xmlslurper/></head><body><section id=masthead><h1><a href=/ title="Tony Wolski">Tony Wolski</a></h1><nav><ul><li><a href=/contact title=Contact>Contact</a></li></ul></nav></section><div id=content><article class=post><header><h1>Template SoapUI tests with XmlSlurper</h1><small>2014-09-04</small></header><p>In between urgent bug fixes and planned sprint work I&rsquo;ve been trying to find time to write an automated test suite with <a href=http://www.soapui.org/>SoapUI</a> to verify some of the things we can&rsquo;t in <a href=http://awolski.com/unit-tests-worth-their-weight-in-gold/>unit tests</a>. After writing a few SoapUI tests by copying the same SOAP request between test cases, but slightly modifying the content of one or two elements, I wondered whether it would be <del>easier</del> smarter to reuse a template SOAP request and somehow replace only the element/attribute content that differs between tests.</p><p>With a little bit of Groovy (specifically <a href="http://groovy.codehaus.org/Reading+XML+using+Groovy's+XmlSlurper">XmlSlurper</a>) you can, and here&rsquo;s how I did it.*</p><p>I created a template directory in the same location as my SoapUI project file, in which I store my template SOAP request(s). Load this project path using SoapUI&rsquo;s GroovyUtil:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=color:#66d9ef>def</span> projectDir <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> com<span style=color:#f92672>.</span><span style=color:#a6e22e>eviware</span><span style=color:#f92672>.</span><span style=color:#a6e22e>soapui</span><span style=color:#f92672>.</span><span style=color:#a6e22e>support</span><span style=color:#f92672>.</span><span style=color:#a6e22e>GroovyUtils</span><span style=color:#f92672>(</span>context<span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getProjectPath</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#960050;background-color:#1e0010>`</span>
</code></pre></div><p>Then load the specific template you want to use:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=color:#66d9ef>def</span> template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>.</span><span style=color:#a6e22e>File</span><span style=color:#f92672>(</span>projectDir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/templates/generateAccount_renewalStub.xml&#34;</span><span style=color:#f92672>)</span><span style=color:#960050;background-color:#1e0010>`</span>
</code></pre></div><p>And create a new XmlSlurper instance reading the template:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=color:#66d9ef>def</span> root <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> XmlSlurper<span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>parse</span><span style=color:#f92672>(</span>template<span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>declareNamespace</span><span style=color:#f92672>(</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>)</span><span style=color:#960050;background-color:#1e0010>`</span>
</code></pre></div><p>For each test case, I create test properties in the same <a href=http://groovy.codehaus.org/Groovy+Beans>Groovy Bean</a> format that XmlSlurper uses to access XML elements and attributes (e.g. <code>request.inUser.username</code>). The property values are what I want to replace the template content with. So you can use Eval.x to set the</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>testRunner<span style=color:#f92672>.</span><span style=color:#a6e22e>testCase</span><span style=color:#f92672>.</span><span style=color:#a6e22e>properties</span><span style=color:#f92672>.</span><span style=color:#a6e22e>each</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span> k<span style=color:#f92672>,</span> v <span style=color:#f92672>-</span><span style=color:#f92672>&gt;</span>
   <span style=color:#75715e>// Use Eval.x to update the content of the element at ${k} with the value ${v}
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><p>Then you can use the content of the updated template request and <a href=http://www.soapui.org/Functional-Testing/transferring-property-values.html>transfer it as a property value</a> to the next test step (such as a Test Request), the property accessed via <code>${Properties.testRequest}</code></p><p><em>* I&rsquo;m still yet to get the Eval.x working to set properties with indexes, e.g. element[0], so my solution is not yet complete.</em></p><footer>&#171; <a href=https://awolski.com/unit-tests-worth-their-weight-in-gold/>Previous</a>
||
<a href=https://awolski.com/cloudbees-continuous-delivery-summit-part-ii/>Next</a> &#187;</footer></article><div id=comments><strong>Your thoughts?</strong> I'd love to hear them. Please get in <a href=/contact>contact</a>.</div></div></body></html>